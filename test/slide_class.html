<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
 <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title></title>
</head>
<!-- <link rel="stylesheet" href="basic.css"> -->
<style>
	body{margin:0; padding: 0}
	section{
		position: relative;
		width: 100%;
		height: 90vh;
	}
	h1{
		font-size: 15px;
	}

button{
	    appearance: none;
    -moz-appearance: none;
    -webkit-appearance: none;
     outline: none;

/*	-webkit-appearance:button;
	-moz-appearance:button;*/
	border-radius:0;
	border: none;
}
	
.slide {
	position: relative;
	overflow: hidden;
	width: 100%;
	height: 100%;
	/*left: 370px;*/
}

.slide .items > li {
	position: absolute;
	top: 0;
	left: 100%;
	width: 100%;
	height: 100%;
	list-style: none;
	overflow: hidden;
}

.slide .items > li:nth-child(1) {
	background-color: red;
}

.slide .items > li:nth-child(2) {
	background-color: orange;
}

.slide .items > li:nth-child(3) {
	background-color: green;
}

.slide .items > li:nth-child(4) {
	background-color: blue;
}

.slide .btn > button {
	
	position: absolute;
	width: 96px;
	height: 96px;
	top: 50%;
	transform: translateY(-50%);
	border: 0;
	padding: 0;
	cursor: pointer;
	background: transparent;
}


.slide .btn .prev { left: 0px; }
.slide .btn .next {  right: 0px; }

@media (min-width: 1025px){
	.slide .btn .prev { left: 15%; }
	.slide .btn .next { 	right: 15%; 	}
}/**/
.slide .btn{ display: none; }

.slide .slideMap {
    position: absolute;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    padding: 0;
}

.slide .slideMap button {
	position: relative;
	display: inline-block;
    vertical-align: middle;
	width: 10px;
	height: 10px;
	margin: 0 3px;
	padding: 0;
	border: 0.5px solid #fff;
	border-radius: 50%;
	background-color: transparent;
	cursor: pointer;

}
@media ( max-width: 414px ){
	.slide .slideMap button {
		width: 1.87vw;
		height: 1.87vw;
	}
}
.slide .slideMap .locate.on {
	background-color: #fff;
}

button.play, button.stop { 
    width: 16px !important;
    height: 16px !important;
    border: none !important;
	background: rgba(0,0,0,.2) !important;
}



.play:before{
	content: '';
	position: absolute;
	left: 50%;
	top: 50%;
	transform: translate(-40%, -50%);
	width: 0px;
	height: 0px;
	border-top: .3em solid transparent;
	border-left: 0.45em solid rgba(255,255,255,.7);
	border-bottom: .3em solid transparent;
}

.stop:before{
	content: '';
	position: absolute;
	left: 50%;
	top: 50%;
	transform: translate(-50%, -50%);
	width: .1em;
	height: .5em;
	border-left: .15em solid #fff;
	border-right: 0.15em solid #fff;
}

.icons{
	position:relative;
	z-index: 33;
	display:inline-block;
	width:100%;
	height: 100%;
	background: rgba(0,0,0,.2);

}

.arrowLeft:before{
	content: '';
	position: absolute;
	top:50%;
	left:50%;
	width: 2em;
	height: 2em;
	border-top:2px solid #fff;
	border-left:2px solid #fff;
	background: none;
	transform: translateX(-25%) translateY(-50%) rotate(-45deg);
}

.arrowRight:before{
	content: '';
	position: absolute;
	top:50%;
	right:35%;
	width: 2em;
	height: 2em;
	border-bottom:2px solid #fff;
	border-right:2px solid #fff;
	background: none;
	transform: translateX(-25%) translateY(-50%) rotate(-45deg);
}
</style>
<body>
	<section style="background: #f5f5f5"></section>

	<section>
		<div class="slide">
			<ul class="items">
				<li>
					<!-- <img src="김다온.png"> -->
					<button class="moreLink">자세히보기</button> <!-- -->
				</li>
				<li><!--<img src="main-master/img/test.png">
					 <button class="moreLink">자세히보기</button> --></li>
				<li><!--<img src="김다온.png">
					 <button class="moreLink">자세히보기</button> --></li>
				<li><!--<img src="김다온.png">
					 <button class="moreLink">자세히보기</button> --></li>
			</ul>
			<div class="btn">
				<button type="button" class="prev"><span class="icons arrowLeft"></span></button>
				<button type="button" class="next"><span class="icons arrowRight"></span></button>
			</div>
		</div>
	</section>
<!-- 	<section>
		<div class="slide">
			<ul class="items">
				<li>1</li>
				<li>2</li>
				<li>3</li>
				<li>4</li>
			</ul>
			<div class="btn">
				<button type="button" class="prev"><span class="icons arrowLeft"></span></button>
				<button type="button" class="next"><span class="icons arrowRight"></span></button>
			</div>
-->
		</div>
	</section> -->
	<!-- --><section style="background: #f5f5f5"></section>
	<section style="background: #f5f5f5"></section>
	<section style="background: #f5f5f5"></section>
	<section style="background: #f5f5f5"></section>
	<section style="background: #ff0"></section> 
<h1 style="position: fixed; top: 2em; left: 2em; background: #000; color: #fff; padding: .5em 1em;"></h1>
<h1 style="position: fixed; top: 7em; left: 2em; background: #000; color: #fff; padding: .5em 1em;"></h1>
<h1 style="position: fixed; top: 12em; left: 2em; background: #000; color: #fff; padding: .5em 1em;"></h1>
<script>

'use strict';




let myArray = ["zero", "one", "two"];
myArray.myMethod = function (sProperty) {
	console.log(arguments, arguments.length);
    console.log(arguments.length > 0 ? this[sProperty] : this);
};

myArray.myMethod(); // prints "zero,one,two"
myArray.myMethod(2); // prints "one"


class Rectangle {
  constructor(height, width) {
    this.height = height;
    this.width = width;
  }
  // Getter
  get area() {
    return this.calcArea();
  }
  // 메서드
  calcArea() {
    return this.height * this.width;
  }
}

const square = new Rectangle(10, 10);

console.log(square.area);

var click = {

	findTagName : function(elem, tagName){

		let elemName = elem.nodeName;

		while( elemName !== tagName )
		{
			elem = elem.parentNode;

			if( elem === document ) 
				return null;

			elemName = elem.nodeName;
			//
		}	// console.log( 'while : ', elemName);
		return elem;
	},

	findClassName : function(items, className){

		for( let k = 0; k < items.children.length; k++ )
		{
			if( items.children[k].classList.contains(className) )
			{
				return k;
			}
		}
		return false;
	}

}

class mySlide{

	constructor(body, speed){
		this.body = body;
		this.items = null;
		this.map = null;		
		this.speed = speed;
		this.after = null;
		this.now = null;
		this.pause = "off";
		this.autoPlay = "stop";
		this.ongoingTouches = null;
		this.init();
	}

	init(){
		console.log("makeInit", this);

		if( this.body.querySelector('.slideMap') != null )
			return;

		this.items = this.body.querySelector('.items');
		this.items.children[0].style.left  = 0;
		this.items.children[0].classList.add('on');

		var slideMap = document.createElement('div'); //페이지네이션 생성

		for( var i = 0; i < this.items.children.length; i++ )//슬라이드 수만큼 만들
			slideMap.innerHTML += '<button class="locate"></button>';

		slideMap.innerHTML += '<button class="play"></button>';//자동 재생 버튼 설정

		slideMap.classList.add('slideMap');
		slideMap.children[0].classList.add('on');
		this.body.append(slideMap); // 페이지네이션 붙임

		this.map = this.body.querySelector('.slideMap');

		this.body.addEventListener("click", (e) => { this.clickMouse(e); });
		this.body.addEventListener("mousedown", (e) => { this.clickMouse(e); });
		this.body.addEventListener("mouseup", (e) => { this.clickMouse(e); });
		this.body.addEventListener("mouseover", () => {
			this.body.querySelector(".btn").style.display = "block";
		});
		this.body.addEventListener("mouseout", () => {
			this.body.querySelector(".btn").style.display = "none";
		});

		this.body.addEventListener("touchstart", (e) => { this.touchDevice(e); });
		this.body.addEventListener("touchstart", (e) => { 
			this.body.querySelector(".btn").style.display = "block";
			//setTimeout(() => { this.body.querySelector(".btn").style.display = "none"; }, 6000);
		});

		this.body.addEventListener("touchmove", (e) => { this.touchDevice(e); });
		this.body.addEventListener("touchend", (e) => { this.touchDevice(e); });

	}

	touchDevice(e){
		e.preventDefault();

		if( this.ongoingTouches === null || !Array.isArray(this.ongoingTouches) )
		{ console.log("11 ongoingTouches reset");
			this.ongoingTouches = [];
		}

		switch ( e.type )
		{
			case "touchstart":
				if( Array.isArray(this.ongoingTouches) || this.ongoingTouches.length > 1 )
				{console.log("22 ongoingTouches reset");
					this.ongoingTouches.length = 0;
				}

				
				for( let i=0; i<e.touches.length; i++ )
				{
					this.ongoingTouches.push(this.copyTouch(e.touches[i]));
					console.log("touchstart", this.ongoingTouches[i].pageY, e.changedTouches[i].pageY);

				}
				

				
			
				break;
			case "touchmove":
				//document.querySelector('html').scrollHeight
				let idx;
				for( let i=0; i<e.changedTouches.length; i++ )
				{
					idx = this.ongoingTouchIndexById(e.changedTouches[i].identifier);
					//console.log("idx", idx);

					if (idx < 0) 
					{
						console.log("can't figure out which touch to continue");
						return;
					}					

					document.querySelectorAll("h1")[2].innerHTML = document.querySelector('html').scrollTop + " / " + (e.changedTouches[i].pageY- e.changedTouches[i].clientY);

					// Math.abs( this.ongoingTouches[0].screenY - e.changedTouches[0].screenY )
					if( Math.abs( this.ongoingTouches[0].pageY - e.changedTouches[0].pageY ) > 0)
					{
						
						document.querySelector('html').scrollTop += (this.ongoingTouches[0].pageY - e.changedTouches[0].pageY);

					}
					// if( Math.abs( this.ongoingTouches[0].screenY - e.changedTouches[0].screenY ) > 0 )
					// {
						
					// 	document.querySelector('html').scrollTop = e.changedTouches[0].pageY- e.changedTouches[0].clientY;

					// }

				}

				break;
			case "touchend":
				var t = e.changedTouches;

				document.querySelector("h1").innerHTML = "touchend : " + this.ongoingTouches[0].force+", "+e.changedTouches[0].force + "//";

				let touchMovingX = this.ongoingTouches[0].screenX - e.changedTouches[0].screenX;
				let touchMovingY = this.ongoingTouches[0].screenY - e.changedTouches[0].screenY;

				console.log("touchMovingY ",window.innerHeight/7," > ",Math.abs( touchMovingY ), " > ", window.innerHeight/10);

				if( window.innerHeight/7 > Math.abs( touchMovingY ) && Math.abs( touchMovingY ) > window.innerHeight/10 )
				{	
					let slidingID = null;
					let next=1;
					let st = document.querySelector('html').scrollTop;

					console.log("setInterval__touchMoving ");
					if( touchMovingY < 0 ) next = -1;
					
					slidingID = setInterval(function(){

						if(document.querySelector('html').scrollTop === 0 || Math.abs( st - document.querySelector('html').scrollTop ) > 320 )// font-size 16px 기준
						{
							console.log("end setInterval__touchMoving");
							clearInterval(slidingID);
						}
						document.querySelector('html').scrollTop += (8*next);

					 }, 10);
				}
				// else
				// {	
					console.log("innerWidth ", window.innerWidth);
					let elem = click.findTagName(e.target, "BUTTON");				
					
					

					// if( touchMovingX === 0 &&  elem === null )
					// {
					// 	console.log("1 touchDevice");
					// 	return;
					// }
					// else 
						if( touchMovingX === 0 &&  elem !== null )
					{
						console.log("2 touchDevice");
						this.executeSlide(elem, "next");
					}
					else if( Math.abs( touchMovingX ) > window.innerWidth/10 )
					{
						if( touchMovingX > 0 ) this.executeSlide(null, "next");
						else this.executeSlide(null, "prev");
					}					
				//}

				break;
		}
				
	}

	copyTouch({ identifier, pageX, pageY, screenX, screenY }) {
		return { identifier, pageX, pageY, screenX, screenY };
	}

	ongoingTouchIndexById(idToFind) {
		for (var i = 0; i < this.ongoingTouches.length; i++)
		{
			var id = this.ongoingTouches[i].identifier;

			if (id == idToFind)
			{
				return i;
			}
		}
		return -1;    // not found
	}


	clickMouse(e){
		console.log("clickMouse");

		if( this.ongoingTouches === null || Array.isArray(this.ongoingTouches) )
		{console.log( "touchDevice  isArray", this);
			this.ongoingTouches = {};
		}

		let className;

		let elem = click.findTagName(e.target, "BUTTON");

		if( elem === null )
		{
			

			if( e.type === "mousedown" )
			{
				this.ongoingTouches.x = e.x;
				console.log( "11 clickMouse ", this.ongoingTouches);
			}
			
			if( e.type === "mouseup" )
			{
				if( this.ongoingTouches.x - e.x === 0 ) return;
				else if( this.ongoingTouches.x - e.x > 0 ) this.move(1);
				else this.move(-1);
			}
			return;		 
		}
		else
		{
			if( e.type === "mousedown" ||  e.type === "mouseup" ) return;
		}

		console.log( "11 clickMouse ", e.type);

		if( elem.classList.length > 1 )
			className = elem.classList[0];
		else
			className = elem.className;


		switch( className )
		{
			case "next":
				this.checkAutoPlay();				
				this.move(1);
				break;

			case "prev":
				this.checkAutoPlay();
				this.move(-1);		
				break;

			case "play":
				elem.classList.add("stop");	
				elem.classList.remove("play");
				this.autoPlay =  setInterval( () => { this.move(1); }, 6000);
				break;

			case "stop":
				clearInterval(this.autoPlay);
				this.autoPlay = "stop";//console.log("stop ",this);
				elem.classList.add("play");
				elem.classList.remove("stop");
				break;		

			case "locate":
				this.checkAutoPlay();

				let init = { after : -1,  now : null, direction : null, width : this.items.offsetWidth};
				let slideMap = elem;

				while( slideMap != null ) 
				{
					slideMap = slideMap.previousElementSibling;
					init.after++; // 클릭한 페이지네이션 번호
				}
				init.now = click.findClassName(this.items, "on");

				if( init.after - init.now > 0 ) init.direction = 1;
				else init.direction = -1;

				if( Math.abs(init.after - init.now) == 1 ) 
				{
					this.move(init.direction);
				}
				else if( Math.abs(init.after - init.now) > 1 ) // 간격이 2이상인 경우
				{ console.log("12345678 ",init.after - init.now);
					
					setTimeout(() => { this.quickLocate(init.width, init.now, init.after, init.direction) }, init.width/5);
				}

				break;	

		}
	}

	executeSlide(elem, str){

		let exe;

		if( elem !== null )
		{
			if( elem.classList.length > 1 )
				exe = elem.classList[0];
			else
				exe = elem.className;
		}
		else
		{
			exe = str;
		}

		switch( exe )
		{
			case "next":
				this.checkAutoPlay();				
				this.move(1);
				break;

			case "prev":
				this.checkAutoPlay();
				this.move(-1);		
				break;

			case "play":
				elem.classList.add("stop");	
				elem.classList.remove("play");
				this.autoPlay =  setInterval( () => { this.move(1); }, 6000);
				break;

			case "stop":
				clearInterval(this.autoPlay);
				this.autoPlay = "stop";//console.log("stop ",this);
				elem.classList.add("play");
				elem.classList.remove("stop");
				break;		

			case "locate":
				this.checkAutoPlay();

				let init = { after : -1,  now : null, direction : null, width : this.items.offsetWidth};
				let slideMap = elem;

				while( slideMap != null ) 
				{
					slideMap = slideMap.previousElementSibling;
					init.after++; // 클릭한 페이지네이션 번호
				}
				init.now = click.findClassName(this.items, "on");

				if( init.after - init.now > 0 ) init.direction = 1;
				else init.direction = -1;

				if( Math.abs(init.after - init.now) == 1 ) 
				{
					this.move(init.direction);
				}
				else if( Math.abs(init.after - init.now) > 1 ) // 간격이 2이상인 경우
				{ console.log("12345678 ",init.after - init.now);
					
					setTimeout(() => { this.quickLocate(init.width, init.now, init.after, init.direction) }, init.width/5);
				}

				break;	

		}

	}

	move(order){

		this.now = click.findClassName(this.items, "on");

		if( order > 0 && this.now >= this.items.children.length - 1 )
			this.after = 0;
		else if( order < 0 && this.now < 1  )
			this.after = this.items.children.length - 1;					
		else
			this.after = this.now + order;	

		var prevLeft = 0;
		var nextLeft;
		var setMovement = null;
		var after = this.after;
		var now = this.now;
		var speed = this.speed;
		var items = this.items;

		console.log("\n 9999 move ",this.speed,"\n");
		
		nextLeft = this.items.offsetWidth * order;

		setMovement = setInterval( () => {

			// nextLeft -= (speed * order);

			// if( order > 0 && nextLeft <= 0 ) //next
			// {
			// 	nextLeft = 0;
			// 	console.log("11 ", nextLeft);
			// 	clearInterval(setMovement);
			// }
			// else if( order < 0 && nextLeft >= 0 )//prev
			// {
			// 	console.log("22 ", nextLeft);
			// 	nextLeft = 0;
			// 	//nextLeft = this.items.offsetWidth;
			// 	clearInterval(setMovement);
			// }

			// prevLeft -= (speed * order);
			if( order > 0 ) //next
			{
				nextLeft -= speed;

				if( nextLeft <= 0 )
				{
					nextLeft = 0;
					clearInterval(setMovement);
				}

				//prevLeft -= speed;
			}
			else //prev
			{
				nextLeft += speed;

				if( nextLeft >= 0 )
				{
					nextLeft = 0;
					clearInterval(setMovement);
				}

				//prevLeft += speed;
			}

			prevLeft -= (speed * order);

			items.children[after].style.left = nextLeft + 'px';
			items.children[now].style.left = prevLeft + 'px';

		}, 0);

		items.children[after].classList.add('on');
		items.children[now].classList.remove('on');			

		this.map.children[after].classList.add('on');
		this.map.children[now].classList.remove('on');
	}


	checkAutoPlay(){

		if( this.autoPlay !== "stop" && this.pause === "off" )
		{
			clearInterval(this.autoPlay);
			this.autoPlay = "stop";
			//this.pause = "on";

			this.autoPlay =  setInterval( () => { this.move(1); }, 6000);
		}
	}

	quickLocate(w, now, after, dir){

		//console.log("00 quickLocate ", w);

		this.move(dir);

		if( Math.abs( after-now ) == 1 )
			return;

		now += dir;
		setTimeout(() => { this.quickLocate(w, now, after, dir) }, w/2);

	}
}




function slideInit(){

	let slide = document.querySelectorAll('.slide');
	let arr;

	if( slide !== null )
	{
		for( let i=0; i<slide.length; i++ )
		{
			arr =new mySlide(slide[i], 8);
		}
	}

console.log("load, resize");

}


slideInit();
window.addEventListener('resize', slideInit);
document.querySelector(".moreLink").addEventListener("touchstart", mySlide.touchDevice);

// document.querySelector('html').addEventListener('touchmove', function(e){
// 	let st = document.querySelector('html').scrollTop;

// 	let temp = st + e.touches[0].clientY;
// 	document.querySelectorAll("h1")[2].innerHTML = document.querySelector('html').scrollHeight +"<br> scrollTop : "+ document.querySelector('html').scrollTop + " / "+
// 	"<br>"+e.touches[0].clientX + "," + e.touches[0].clientY;
// });

// var src = document.querySelector('html');
// var clientX, clientY, pageY;

// src.addEventListener('touchstart', function(e) {
//   // Cache the client X/Y coordinates
//   clientX = e.touches[0].clientX;
//   clientY = e.touches[0].screenY;
//   pageY = e.touches[0].pageY;
// }, false);

// src.addEventListener('touchend', function(e) {
//   var deltaX, deltaY, deltapageY;

//   // Compute the change in X and Y coordinates.
//   // The first touch point in the changedTouches
//   // list is the touch point that was just removed from the surface.
//   deltaX = e.changedTouches[0].clientX - clientX;
//   deltaY = e.changedTouches[0].screenY - clientY;
//   deltapageY = e.changedTouches[0].pageY - pageY ;

//   let st = document.querySelector('html').scrollTop;

// 	let temp = st + deltapageY;

//   console.log("\n clientX : ", clientX, "clientY : ",clientY, "\n deltaX : ", deltaX, "deltaY : ",deltaY, "\n scrollTop : ", temp,"\n ",pageY,e.changedTouches[0].pageY, deltapageY );

//   // Process the data ...
// }, false);
</script>

</body>
</html>
